# 생기부 작성 도우미 (School Life Record Helper) - 개발 진행 상황

## Phase 1: 프로젝트 초기화 및 랜딩 페이지 구축 (완료)
- [x] **프로젝트 초기화**
    - [x] Next.js 앱 초기화
    - [x] 전역 스타일 (Vanilla CSS) 및 폰트 설정
    - [x] 환경 변수 설정 (Gemini API)
- [x] **랜딩 페이지 구현**
    - [x] 헤더 및 네비게이션 (반응형)
    - [x] 개인정보처리방침 (로컬 스토리지 강조)
    - [x] 메인 히어로 섹션 ('by HooniKim' 스타일링)
    - [x] 메뉴 그리드 (4개 메인 아이템 + 설명)
    - [x] 크롬 확장 프로그램 및 유튜브 링크 섹션

## Phase 2: 랜딩 페이지 디자인 고도화 (완료)
- [x] **디자인 전면 개편**
    - [x] Tailwind 클래스 제거 및 Semantic CSS 적용
    - [x] 2x2 그리드 레이아웃 구현 (과세특, 동아리 / 행발, 가통)
    - [x] 카드 디자인 개선 (여백, 테두리, 그림자)
- [x] **UI 디테일 및 기능 개선**
    - [x] 'by HooniKim' 뱃지 위치/각도 정밀 조정
    - [x] 하단 섹션 레이아웃 변경 (나이스 자동입력 가로 배치, 유튜브 수직 배치)
    - [x] 유튜브 영상 16:9 반응형 비율 적용 및 임베드 구현
    - [x] 헤더 네비게이션 메뉴 추가 (우측 상단)

## Phase 3: 과세특(자유학기 세특) 페이지 기본 구현 (완료)
- [x] **기본 기능 구현**
    - [x] 페이지 라우팅 및 기본 레이아웃
    - [x] 활동 내용 입력 (동적 추가/삭제)
    - [x] 생성 옵션 (글자수, 전체 생성 버튼)
- [x] **AI 통합**
    - [x] Gemini API 설정 (gemini-2.0-flash-exp)
    - [x] 프롬프트 엔지니어링 (A/B/C 등급)
    - [x] 생성용 API 라우트
- [x] **기타 페이지 (플레이스홀더)**
    - [x] 동아리 세특 페이지 구현 (완료)
    - [x] 행발 작성, 가정통신문 작성 페이지 생성

## Phase 4: 과세특 페이지 UI/UX 전면 개편 (완료)
- [x] **레이아웃 및 디자인 재구성**
    - [x] Glassmorphism -> Section Card 스타일 변경
    - [x] 좌우 2열 배치 (학생 설정 / 활동 내용)
    - [x] 학생 목록 카드 디자인 개선 (삭제 버튼, 등급 버튼 등)
- [x] **학생 관리 기능 강화**
    - [x] 학생 수 드롭다운 및 '직접 입력' 기능 구현
    - [x] 엑셀 업로드 로직 개선 ('성명'/'이름' 컬럼 자동 인식 및 예외 처리)
    - [x] 텍스트박스 자동 높이 조절 (Auto-resize)

## Phase 5: 기능 디테일 및 로직 고도화 (최근 완료)
- [x] **엑셀 관련 기능 개선**
    - [x] 엑셀 다운로드 버튼 텍스트 추가 및 아이콘 정렬
    - [x] 빈 결과 다운로드 방지 로직 (알림창 표시)
- [x] **UI 사용성 개선**
    - [x] 삭제 버튼 위치 변경 (텍스트박스 상단 우측)
    - [x] 최소 1명 학생 유지 로직 (삭제 방지)
- [x] **생성 로직 고도화**
    - [x] 시스템 프롬프트 구체화 (교육 전문가 페르소나 적용)
    - [x] 짧은 글자수 제한 시 활동 내용 랜덤 선별 로직 추가 (2~3개)

## Phase 6: 프롬프트 엔지니어링 및 UX 고도화 (완료)
- [x] **프롬프트 및 AI 모델 최적화**
    - [x] AI 모델 변경 (gpt-4o -> gpt-4o-mini) 비용 절감 및 속도 개선
    - [x] 학교급(초/중/고) 및 과목명 입력 기능 추가 및 프롬프트 반영
    - [x] 프롬프트 정교화 (학생 호칭 제거, C등급 피드백 개선, 요약/서두 언급 금지)
    - [x] 글자수 제한 로직 강화 (등급별 차등 적용, 600byte 엄격 준수)
    - [x] 활동 내용 랜덤 셔플 및 선별 로직 (글자수에 따른 개수 조절)
- [x] **UI/UX 편의성 개선**
    - [x] 활동 입력 엔터키 연동 및 오토 포커스 구현
    - [x] 결과창 스크롤바 적용 (최대 높이 500px 제한)
    - [x] 개별 생성 버튼 위치 이동 및 '내용 지우기' 버튼 추가
    - [x] 학생 삭제 아이콘 변경 (UserX) 및 툴팁 추가
    - [x] 전체 생성 완료 시 재생성 확인 팝업 및 생성 상태(Loading) 오류 수정
    - [x] 파비콘 아이콘 변경 (H 로고, 투명 배경)

## Phase 7: 동아리 세특 및 행발 페이지 구현 (완료)
- [x] **동아리 세특 페이지 구축**
    - [x] 과세특 페이지 UI/UX 계승 (통일성 유지)
    - [x] 학생 등급(A/B/C) 선택 기능 제거
    - [x] 동아리명 입력 필드 적용
    - [x] 동아리 전용 프롬프트 적용 및 관점(Perspective) 다양화 로직 구현
- [x] **행발 작성 페이지 구축**
    - [x] 활동 내용 입력 섹션 제거 및 생성 옵션 재배치
    - [x] 학생별 '행동 관찰 결과' 입력 필드 추가
    - [x] 행발 전용 프롬프트(긍정적 재구성 등) 적용
    - [x] 엑셀 업로드 개선 ('행동', '관찰' 컬럼 자동 인식 및 매핑)
- [x] **가정통신문 작성 페이지 구축**
    - [x] 여름방학/겨울방학 선택 옵션 구현
    - [x] 공통 키워드 입력 필드 추가 (기본값: 학업, 건강 등)
    - [x] 학생별 개별 입력 필드 제거 (일괄 생성 방식)
    - [x] 방학별 맞춤형 프롬프트 적용
- [x] **세부 설정 및 로직 검증**
    - [x] 과세특 학생 기본 등급 변경 (B -> A)
    - [x] 동아리 세특 학교급 기본값 변경 (고등학교 -> 중학교)
    - [x] 글자수 제한에 따른 활동 선별 로직 검증 완료
    - [x] 전 페이지 글자수 제한 로직 강화 (공백 포함 엄격 준수)

## Phase 8: 최종 검증 및 배포 준비 (완료)
- [x] **최종 테스트**
    - [x] 모바일/태블릿 반응형 최종 점검 (CSS 미디어 쿼리 확인 완료)
    - [x] 엑셀 대량 데이터 처리 테스트 (파싱 로직 검증 완료)
    - [x] AI 생성 품질 최종 확인 (프롬프트 최적화 완료)

# 프로젝트 완료 (Web App)
모든 웹 애플리케이션 개발 단계가 완료되었습니다.
- 과세특, 동아리 세특, 행발, 가정통신문 작성 기능 구현 완료.
- UI/UX 통일성 확보 및 반응형 디자인 적용.
- AI 프롬프트 최적화 및 글자수 제한 로직 강화.

## Phase 9: 크롬 확장 프로그램 개발 (완료)
- [x] **확장 프로그램 기본 설정**
    - [x] Manifest V3 설정 (`manifest.json`)
    - [x] 아이콘 및 기본 리소스 구성 (아이콘 누락 및 리사이징 수정 완료)
    - [x] **[NEW] 명칭 및 용어 변경 (ACE -> 나이스 자동입력 도우미, 교과평어 -> 과세특, 행동특성 -> 행발)**
- [x] **UI 구현 (Popup)**
    - [x] 디자인 시안(이미지) 기반 UI 구현 (HTML/CSS)
    - [x] **[NEW] UI 디자인 전면 개편 (Web App 스타일 통일, Outfit 폰트, 카드 레이아웃)**
    - [x] 상태 표시창 (데이터 개수 확인)
    - [x] 데이터 가져오기 / 자동 입력 버튼 구현
- [x] **기능 구현: 데이터 가져오기 (From Web App)**
    - [x] Content Script: 웹 앱 DOM 파싱 및 데이터 추출
    - [x] Chrome Storage 저장 로직
- [x] **기능 구현: 자동 입력 (To NEIS)**
    - [x] Content Script: NEIS 입력 필드 식별 및 값 주입
    - [x] 자동 입력 순회 로직 (매크로 성격)
    - [x] **[NEW] 가상 스크롤 및 그리드 대응 (Scroll, ArrowDown, Enter 전략 적용)**

## Phase 10: NEIS 자동 입력 고도화 및 디버깅 (완료 ✅)
- [x] **이름 기반 매칭 시스템 구현**
    - [x] 행 순서 대신 학생 이름으로 매칭하는 `processAutoFillByName` 함수 구현
    - [x] `findStudentRow` 함수: 그리드에서 학생 이름 검색 및 스크롤 지원
    - [x] 가상 스크롤 대응: DOM에 없는 학생은 스크롤하여 검색
- [x] **NEIS Floating Textarea 대응**
    - [x] NEIS가 row 내부가 아닌 floating textarea 사용함을 발견
    - [x] `aria-label` 속성에서 행 번호 추출 (`N행 마지막 열...` 형식)
    - [x] `data-rowindex`와 `aria-label` 행 번호 매핑 로직 구현
    - [x] `findActiveTextareaInDocument` 함수: 전체 document에서 활성 textarea 검색
- [x] **Textarea 활성화 로직 강화**
    - [x] 다중 활성화 전략: Direct click, Double-click, Focus+Enter, Focus+F2, Control wrapper click
    - [x] 스크롤 후 row 재검색 로직 (가상 스크롤로 DOM 변경 대응)
    - [x] ~~ESC 키 + blur로 강제 닫기~~ → **Tab 키로 변경 (데이터 저장 보장)**
    - [x] 좌표 기반 MouseEvent 시뮬레이션 (8-cell 행 대응)
- [x] **셀 탐색 로직 개선 (8 cells 구조 대응)**
    - [x] Strategy 1: row 내 기존 editable textarea 확인
    - [x] Strategy 2: `.cl-control.cl-textarea` (non-readonly) 검색
    - [x] Strategy 3: 모든 셀에서 textarea control 검색
    - [x] Strategy 4: `aria-label`에서 '세부능력'/'특기사항' 키워드로 셀 탐색
    - [x] Final fallback: 8 cells → cell 7, 7 cells → cell 5 사용
- [x] **장기결석 행 이후 8-cell 행 특별 처리**
    - [x] 8-cell 감지 시 **Tab 네비게이션 전략** 적용 (NEIS 자동 스크롤 활용)
    - [x] 현재 textarea에서 Tab 키로 다음 행 이동
    - [x] 정확한 aria-row 매칭 필수 (±2 tolerance 제거)
    - [x] scrollIntoView fallback 적용
- [x] **Readonly 셀 대응 (분할된 행 처리)**
    - [x] 1-cell readonly 행 감지 시 Tab 네비게이션으로 다음 textarea 이동
    - [x] 마지막 학생(허지훈 등) 정상 입력 완료
- [x] **테스트 및 검증 완료**
    - [x] 26/26명 (100%) 입력 성공 확인
    - [x] 장기결석 행 이후 학생 입력 정상 동작 확인

### 최종 상태 (2025-12-06) ✅
- **26/26명 (100%) 입력 성공**
- 모든 문제 해결됨:
  - 장기결석 행 이후 8-cell 행: Tab 네비게이션으로 NEIS 자동 스크롤 활용
  - Readonly 분할 행: Tab 키로 다음 입력 가능 셀 이동
  - 데이터 손실 방지: ESC → Tab 변경으로 저장 보장

# 프로젝트 완료 (Chrome Extension) 🎉
NEIS 자동 입력 크롬 확장 프로그램 개발이 완료되었습니다.
- 웹앱에서 생성된 데이터를 NEIS에 자동 입력하는 기능 구현 완료.
- 가상 스크롤, 8-cell 행, readonly 셀 등 NEIS 특수 구조 완벽 대응.
- Tab 네비게이션 전략으로 안정적인 자동 입력 구현.

## Phase 11: 글자수 제한 엄격 준수 기능 강화 (완료)
- [x] **프롬프트 강화 (전체 페이지 적용)**
    - [x] 글자수 제한 지시문 전면 개편 (최우선 준수 사항으로 강조)
    - [x] "절대 규칙", "초과시 무효화" 등 강력한 표현 사용
    - [x] 작성 전/후 글자수 확인 지시 추가
- [x] **활동 선별 로직 강화 (과세특, 동아리 세특)**
    - [x] 80자 미만: 활동 1개만 선택
    - [x] 150자 이하: 최대 2개 선택
    - [x] 250자 이하: 최대 3개 선택
    - [x] 350자 이하: 최대 4개 선택
    - [x] 350자 초과: 모든 활동 사용
- [x] **후처리 함수 추가 (전체 페이지 적용)**
    - [x] `truncateToCharLimit()` 함수 구현
    - [x] AI 응답이 글자수 초과 시 자동으로 자르기
    - [x] 마지막 완전한 문장(마침표)에서 자르기 (70% 이후)
    - [x] 불완전한 경우 마침표 자동 추가 (~함. ~임. 등 종결)
    - [x] 콘솔 로그로 자르기 작업 기록

### 적용 페이지
- 과세특 (`/gwasetuk`) ✅
- 동아리 세특 (`/club`) ✅
- 행발 작성 (`/behavior`) ✅
- 가정통신문 (`/letter`) ✅

## Phase 12: 행발 페이지 엑셀 업로드 기능 개선 (완료)
- [x] **엑셀 파싱 로직 개선**
    - [x] 헤더 행 디버깅 로그 추가 (열 인덱스 및 열 이름 출력)
    - [x] 행동 관찰 결과 열 인식 키워드 확장
        - 기존: 행동, 관찰, 특성
        - 추가: 관찰결과, 행동관찰, 행발, 결과, 종합의견
    - [x] 파싱 결과 디버깅 로그 추가 (nameColIndex, observationColIndex, headerRowIndex)
    - [x] 학생별 관찰결과 로그 출력

### 인식 가능한 열 이름 키워드
| 키워드 | 예시 열 이름 |
|--------|-------------|
| 관찰결과 | 관찰 결과, 행동 관찰 결과 |
| 행동관찰 | 행동 관찰 내용 |
| 행발 | 행발, 행발 내용 |
| 행동 | 행동 특성 |
| 관찰 | 관찰 기록 |
| 결과 | 관찰결과 |
| 특성 | 행동특성 |
| 종합의견 | 종합의견 |

## Phase 13: 과세특 페이지 학생별 개별 활동 기능 추가 (완료)
- [x] **Student 상태 구조 확장**
    - [x] `individualActivity` 필드 추가 (초기값 및 updateStudentList 함수 모두 적용)
- [x] **엑셀 업로드 로직 수정**
    - [x] '활동 내용' 열 자동 인식 추가
    - [x] 인식 키워드: '활동', '내용', '관찰내용', '관찰기록'
    - [x] 학생 데이터에 individualActivity 필드 포함하여 저장
- [x] **학생 카드 UI 수정**
    - [x] 등급 버튼(A/B/C)과 액션 버튼 사이에 textarea 추가
    - [x] placeholder: "학생별 개별적으로 활동한 내용을 입력해주세요."
- [x] **생성 로직 수정**
    - [x] `calculateRelevanceScore()` 함수 추가 (키워드 매칭으로 유사도 계산)
    - [x] 공통 활동과 학생별 개별 활동을 조합하여 프롬프트 생성
    - [x] 글자수 제한 시 학생별 활동과 관련성 높은 공통 활동 우선 선택

## Phase 14: AI 텍스트 생성 후처리 로직 고도화 (완료)
- [x] **공통 유틸리티 추가**
    - [x] `textProcessor.js` 파일 추가 (AI 텍스트 후처리 전용 모듈)
    - [x] 동적 버퍼 비율 적용 (글자수에 따라 자동 조절)
    - [x] 글자수별 맞춤 프롬프트 생성
    - [x] 완전한 문장에서 자르기 (트리밍 로직 개선)
- [x] **과세특 엑셀 업로드 키워드 확장**
    - [x] 신규 인식 키워드 추가: '세부능력', '특기사항', '세특', '개별활동'
    - [x] 세부능력/특기사항/세특 열 자동 인식 강화

### 적용 페이지
- 과세특 (`/gwasetuk`) ✅
- 동아리 세특 (`/club`) ✅
- 행발 작성 (`/behavior`) ✅
- 가정통신문 (`/letter`) ✅

## Phase 15: 동아리 세특 페이지 학생별 개별 활동 기능 추가 (완료)
- [x] **Student 상태 구조 확장**
    - [x] `individualActivity` 필드 추가 (초기값 및 `updateStudentList` 함수 모두 적용)
- [x] **엑셀 업로드 로직 수정**
    - [x] '활동 내용' 열 자동 인식 추가
    - [x] 인식 키워드: '활동', '내용', '관찰내용', '관찰기록', '세부능력', '특기사항', '세특', '개별활동'
    - [x] 학생 데이터에 `individualActivity` 필드 포함하여 저장
- [x] **학생 카드 UI 수정**
    - [x] 개별 활동 textarea 추가 (placeholder: "학생별 개별적으로 활동한 내용을 입력해주세요.")
- [x] **생성 로직 수정**
    - [x] `calculateRelevanceScore()` 함수 추가 (키워드 매칭으로 유사도 계산)
    - [x] 공통 활동과 학생별 개별 활동을 조합하여 프롬프트 생성
    - [x] 글자수 제한 시 학생별 활동과 관련성 높은 공통 활동 우선 선택

## Phase 16: 과세특 페이지 추가 지침 사항 기능 추가 (완료)
- [x] **State 추가**
    - [x] `additionalInstructions` state 추가
- [x] **프롬프트 연동**
    - [x] AI 프롬프트에 최우선 지침 섹션 추가 (다른 모든 규칙보다 우선 적용)
- [x] **UI 구현**
    - [x] 활동 입력 섹션 하단에 빨간색 테마 textarea 추가
    - [x] placeholder: "예: 축구는 단체 경기가 아닌 개인별 수행 내용을 기준으로 작성해 주세요."
    - [x] 안내 문구: "위 지침은 AI가 최우선으로 엄격히 준수합니다."
    - [x] 스타일: borderColor '#fecaca', backgroundColor '#fef2f2' (빨간색 테마)

