# 생기부 작성 도우미 (School Life Record Helper) - 개발 진행 상황

## Phase 1: 프로젝트 초기화 및 랜딩 페이지 구축 (완료)
- [x] **프로젝트 초기화**
    - [x] Next.js 앱 초기화
    - [x] 전역 스타일 (Vanilla CSS) 및 폰트 설정
    - [x] 환경 변수 설정 (OpenAI API)
- [x] **랜딩 페이지 구현**
    - [x] 헤더 및 네비게이션 (반응형)
    - [x] 개인정보처리방침 (로컬 스토리지 강조)
    - [x] 메인 히어로 섹션 ('by HooniKim' 스타일링)
    - [x] 메뉴 그리드 (4개 메인 아이템 + 설명)
    - [x] 크롬 확장 프로그램 및 유튜브 링크 섹션

## Phase 2: 랜딩 페이지 디자인 고도화 (완료)
- [x] **디자인 전면 개편**
    - [x] Tailwind 클래스 제거 및 Semantic CSS 적용
    - [x] 2x2 그리드 레이아웃 구현 (과세특, 동아리 / 행발, 가통)
    - [x] 카드 디자인 개선 (여백, 테두리, 그림자)
- [x] **UI 디테일 및 기능 개선**
    - [x] 'by HooniKim' 뱃지 위치/각도 정밀 조정
    - [x] 하단 섹션 레이아웃 변경 (나이스 자동입력 가로 배치, 유튜브 수직 배치)
    - [x] 유튜브 영상 16:9 반응형 비율 적용 및 임베드 구현
    - [x] 헤더 네비게이션 메뉴 추가 (우측 상단)

## Phase 3: 과세특(자유학기 세특) 페이지 기본 구현 (완료)
- [x] **기본 기능 구현**
    - [x] 페이지 라우팅 및 기본 레이아웃
    - [x] 활동 내용 입력 (동적 추가/삭제)
    - [x] 생성 옵션 (글자수, 전체 생성 버튼)
- [x] **AI 통합**
    - [x] OpenAI API 설정 (GPT-4o)
    - [x] 프롬프트 엔지니어링 (A/B/C 등급)
    - [x] 생성용 API 라우트
- [x] **기타 페이지 (플레이스홀더)**
    - [x] 동아리 세특 페이지 구현 (완료)
    - [x] 행발 작성, 가정통신문 작성 페이지 생성

## Phase 4: 과세특 페이지 UI/UX 전면 개편 (완료)
- [x] **레이아웃 및 디자인 재구성**
    - [x] Glassmorphism -> Section Card 스타일 변경
    - [x] 좌우 2열 배치 (학생 설정 / 활동 내용)
    - [x] 학생 목록 카드 디자인 개선 (삭제 버튼, 등급 버튼 등)
- [x] **학생 관리 기능 강화**
    - [x] 학생 수 드롭다운 및 '직접 입력' 기능 구현
    - [x] 엑셀 업로드 로직 개선 ('성명'/'이름' 컬럼 자동 인식 및 예외 처리)
    - [x] 텍스트박스 자동 높이 조절 (Auto-resize)

## Phase 5: 기능 디테일 및 로직 고도화 (최근 완료)
- [x] **엑셀 관련 기능 개선**
    - [x] 엑셀 다운로드 버튼 텍스트 추가 및 아이콘 정렬
    - [x] 빈 결과 다운로드 방지 로직 (알림창 표시)
- [x] **UI 사용성 개선**
    - [x] 삭제 버튼 위치 변경 (텍스트박스 상단 우측)
    - [x] 최소 1명 학생 유지 로직 (삭제 방지)
- [x] **생성 로직 고도화**
    - [x] 시스템 프롬프트 구체화 (교육 전문가 페르소나 적용)
    - [x] 짧은 글자수 제한 시 활동 내용 랜덤 선별 로직 추가 (2~3개)

## Phase 6: 프롬프트 엔지니어링 및 UX 고도화 (완료)
- [x] **프롬프트 및 AI 모델 최적화**
    - [x] AI 모델 변경 (gpt-4o -> gpt-4o-mini) 비용 절감 및 속도 개선
    - [x] 학교급(초/중/고) 및 과목명 입력 기능 추가 및 프롬프트 반영
    - [x] 프롬프트 정교화 (학생 호칭 제거, C등급 피드백 개선, 요약/서두 언급 금지)
    - [x] 글자수 제한 로직 강화 (등급별 차등 적용, 600byte 엄격 준수)
    - [x] 활동 내용 랜덤 셔플 및 선별 로직 (글자수에 따른 개수 조절)
- [x] **UI/UX 편의성 개선**
    - [x] 활동 입력 엔터키 연동 및 오토 포커스 구현
    - [x] 결과창 스크롤바 적용 (최대 높이 500px 제한)
    - [x] 개별 생성 버튼 위치 이동 및 '내용 지우기' 버튼 추가
    - [x] 학생 삭제 아이콘 변경 (UserX) 및 툴팁 추가
    - [x] 전체 생성 완료 시 재생성 확인 팝업 및 생성 상태(Loading) 오류 수정
    - [x] 파비콘 아이콘 변경 (H 로고, 투명 배경)

## Phase 7: 동아리 세특 및 행발 페이지 구현 (완료)
- [x] **동아리 세특 페이지 구축**
    - [x] 과세특 페이지 UI/UX 계승 (통일성 유지)
    - [x] 학생 등급(A/B/C) 선택 기능 제거
    - [x] 동아리명 입력 필드 적용
    - [x] 동아리 전용 프롬프트 적용 및 관점(Perspective) 다양화 로직 구현
- [x] **행발 작성 페이지 구축**
    - [x] 활동 내용 입력 섹션 제거 및 생성 옵션 재배치
    - [x] 학생별 '행동 관찰 결과' 입력 필드 추가
    - [x] 행발 전용 프롬프트(긍정적 재구성 등) 적용
    - [x] 엑셀 업로드 개선 ('행동', '관찰' 컬럼 자동 인식 및 매핑)
- [x] **가정통신문 작성 페이지 구축**
    - [x] 여름방학/겨울방학 선택 옵션 구현
    - [x] 공통 키워드 입력 필드 추가 (기본값: 학업, 건강 등)
    - [x] 학생별 개별 입력 필드 제거 (일괄 생성 방식)
    - [x] 방학별 맞춤형 프롬프트 적용
- [x] **세부 설정 및 로직 검증**
    - [x] 과세특 학생 기본 등급 변경 (B -> A)
    - [x] 동아리 세특 학교급 기본값 변경 (고등학교 -> 중학교)
    - [x] 글자수 제한에 따른 활동 선별 로직 검증 완료
    - [x] 전 페이지 글자수 제한 로직 강화 (공백 포함 엄격 준수)

## Phase 8: 최종 검증 및 배포 준비 (완료)
- [x] **최종 테스트**
    - [x] 모바일/태블릿 반응형 최종 점검 (CSS 미디어 쿼리 확인 완료)
    - [x] 엑셀 대량 데이터 처리 테스트 (파싱 로직 검증 완료)
    - [x] AI 생성 품질 최종 확인 (프롬프트 최적화 완료)

# 프로젝트 완료 (Web App)
모든 웹 애플리케이션 개발 단계가 완료되었습니다.
- 과세특, 동아리 세특, 행발, 가정통신문 작성 기능 구현 완료.
- UI/UX 통일성 확보 및 반응형 디자인 적용.
- AI 프롬프트 최적화 및 글자수 제한 로직 강화.

## Phase 9: 크롬 확장 프로그램 개발 (완료)
- [x] **확장 프로그램 기본 설정**
    - [x] Manifest V3 설정 (`manifest.json`)
    - [x] 아이콘 및 기본 리소스 구성 (아이콘 누락 및 리사이징 수정 완료)
    - [x] **[NEW] 명칭 및 용어 변경 (ACE -> 나이스 자동입력 도우미, 교과평어 -> 과세특, 행동특성 -> 행발)**
- [x] **UI 구현 (Popup)**
    - [x] 디자인 시안(이미지) 기반 UI 구현 (HTML/CSS)
    - [x] **[NEW] UI 디자인 전면 개편 (Web App 스타일 통일, Outfit 폰트, 카드 레이아웃)**
    - [x] 상태 표시창 (데이터 개수 확인)
    - [x] 데이터 가져오기 / 자동 입력 버튼 구현
- [x] **기능 구현: 데이터 가져오기 (From Web App)**
    - [x] Content Script: 웹 앱 DOM 파싱 및 데이터 추출
    - [x] Chrome Storage 저장 로직
- [x] **기능 구현: 자동 입력 (To NEIS)**
    - [x] Content Script: NEIS 입력 필드 식별 및 값 주입
    - [x] 자동 입력 순회 로직 (매크로 성격)
    - [x] **[NEW] 가상 스크롤 및 그리드 대응 (Scroll, ArrowDown, Enter 전략 적용)**

## Phase 10: NEIS 자동 입력 고도화 및 디버깅 (완료 ✅)
- [x] **이름 기반 매칭 시스템 구현**
    - [x] 행 순서 대신 학생 이름으로 매칭하는 `processAutoFillByName` 함수 구현
    - [x] `findStudentRow` 함수: 그리드에서 학생 이름 검색 및 스크롤 지원
    - [x] 가상 스크롤 대응: DOM에 없는 학생은 스크롤하여 검색
- [x] **NEIS Floating Textarea 대응**
    - [x] NEIS가 row 내부가 아닌 floating textarea 사용함을 발견
    - [x] `aria-label` 속성에서 행 번호 추출 (`N행 마지막 열...` 형식)
    - [x] `data-rowindex`와 `aria-label` 행 번호 매핑 로직 구현
    - [x] `findActiveTextareaInDocument` 함수: 전체 document에서 활성 textarea 검색
- [x] **Textarea 활성화 로직 강화**
    - [x] 다중 활성화 전략: Direct click, Double-click, Focus+Enter, Focus+F2, Control wrapper click
    - [x] 스크롤 후 row 재검색 로직 (가상 스크롤로 DOM 변경 대응)
    - [x] ~~ESC 키 + blur로 강제 닫기~~ → **Tab 키로 변경 (데이터 저장 보장)**
    - [x] 좌표 기반 MouseEvent 시뮬레이션 (8-cell 행 대응)
- [x] **셀 탐색 로직 개선 (8 cells 구조 대응)**
    - [x] Strategy 1: row 내 기존 editable textarea 확인
    - [x] Strategy 2: `.cl-control.cl-textarea` (non-readonly) 검색
    - [x] Strategy 3: 모든 셀에서 textarea control 검색
    - [x] Strategy 4: `aria-label`에서 '세부능력'/'특기사항' 키워드로 셀 탐색
    - [x] Final fallback: 8 cells → cell 7, 7 cells → cell 5 사용
- [x] **장기결석 행 이후 8-cell 행 특별 처리**
    - [x] 8-cell 감지 시 **Tab 네비게이션 전략** 적용 (NEIS 자동 스크롤 활용)
    - [x] 현재 textarea에서 Tab 키로 다음 행 이동
    - [x] 정확한 aria-row 매칭 필수 (±2 tolerance 제거)
    - [x] scrollIntoView fallback 적용
- [x] **Readonly 셀 대응 (분할된 행 처리)**
    - [x] 1-cell readonly 행 감지 시 Tab 네비게이션으로 다음 textarea 이동
    - [x] 마지막 학생(허지훈 등) 정상 입력 완료
- [x] **테스트 및 검증 완료**
    - [x] 26/26명 (100%) 입력 성공 확인
    - [x] 장기결석 행 이후 학생 입력 정상 동작 확인

### 최종 상태 (2025-12-06) ✅
- **26/26명 (100%) 입력 성공**
- 모든 문제 해결됨:
  - 장기결석 행 이후 8-cell 행: Tab 네비게이션으로 NEIS 자동 스크롤 활용
  - Readonly 분할 행: Tab 키로 다음 입력 가능 셀 이동
  - 데이터 손실 방지: ESC → Tab 변경으로 저장 보장

# 프로젝트 완료 (Chrome Extension) 🎉
NEIS 자동 입력 크롬 확장 프로그램 개발이 완료되었습니다.
- 웹앱에서 생성된 데이터를 NEIS에 자동 입력하는 기능 구현 완료.
- 가상 스크롤, 8-cell 행, readonly 셀 등 NEIS 특수 구조 완벽 대응.
- Tab 네비게이션 전략으로 안정적인 자동 입력 구현.

## Phase 11: 글자수 제한 엄격 준수 기능 강화 (완료)
- [x] **프롬프트 강화 (전체 페이지 적용)**
    - [x] 글자수 제한 지시문 전면 개편 (최우선 준수 사항으로 강조)
    - [x] "절대 규칙", "초과시 무효화" 등 강력한 표현 사용
    - [x] 작성 전/후 글자수 확인 지시 추가
- [x] **활동 선별 로직 강화 (과세특, 동아리 세특)**
    - [x] 80자 미만: 활동 1개만 선택
    - [x] 150자 이하: 최대 2개 선택
    - [x] 250자 이하: 최대 3개 선택
    - [x] 350자 이하: 최대 4개 선택
    - [x] 350자 초과: 모든 활동 사용
- [x] **후처리 함수 추가 (전체 페이지 적용)**
    - [x] `truncateToCharLimit()` 함수 구현
    - [x] AI 응답이 글자수 초과 시 자동으로 자르기
    - [x] 마지막 완전한 문장(마침표)에서 자르기 (70% 이후)
    - [x] 불완전한 경우 마침표 자동 추가 (~함. ~임. 등 종결)
    - [x] 콘솔 로그로 자르기 작업 기록

### 적용 페이지
- 과세특 (`/gwasetuk`) ✅
- 동아리 세특 (`/club`) ✅
- 행발 작성 (`/behavior`) ✅
- 가정통신문 (`/letter`) ✅

## Phase 12: 행발 페이지 엑셀 업로드 기능 개선 (완료)
- [x] **엑셀 파싱 로직 개선 (`app/behavior/page.js`)**
    - [x] "관찰 결과" 열 자동 인식 기능 강화
    - [x] 다양한 키워드 지원 추가:
        | 키워드 | 예시 열 이름 |
        |--------|-------------|
        | 관찰 결과 | 관찰 결과, 행동 관찰 결과 |
        | 행동 관찰 | 행동 관찰 내용 |
        | 행발 | 행발, 행발 내용 |
        | 행동 | 행동 특성 |
        | 관찰 | 관찰 기록 |
        | 결과 | 관찰결과 |
        | 특성 | 행동특성 |
        | 종합의견 | 종합의견 |
    - [x] 공백 제거 후 키워드 비교 로직 적용
- [x] **디버깅 로그 추가**
    - [x] 헤더 행 전체 열 이름 콘솔 출력
    - [x] `nameColIndex`, `observationColIndex`, `headerRowIndex` 파싱 결과 로그
    - [x] 학생별 이름 및 관찰 결과 매핑 로그 출력

## Phase 13: 과세특 페이지 학생별 활동 내용 기능 추가 (완료)
- [x] **엑셀 업로드 기능 개선 (`app/gwasetuk/page.js`)**
    - [x] '활동 내용' 열 자동 인식 기능 추가
    - [x] 인식 키워드: 활동, 내용, 관찰내용, 관찰기록
    - [x] 디버깅 로그 추가 (헤더 파싱, 학생별 활동 매핑)
- [x] **Student 상태 구조 확장**
    - [x] `individualActivity` 필드 추가
    - [x] 모든 학생 생성/업데이트 로직에 적용
- [x] **학생 카드 UI 수정**
    - [x] 등급 버튼(A/B/C)과 액션 버튼 사이에 활동 내용 textarea 추가
    - [x] 플레이스홀더: "학생별 개별적으로 활동한 내용을 입력해주세요."
- [x] **생성 로직 개선**
    - [x] 공통 활동과 학생별 활동 조합하여 프롬프트 생성
    - [x] 글자수 제한 시 학생별 활동과 관련성 높은 공통 활동 우선 선택
    - [x] `calculateRelevanceScore` 함수로 키워드 기반 관련성 점수 계산

## Phase 14: 크롬 확장 프로그램 행발 자동 입력 기능 수정 (완료)
- [x] **셀 탐색 로직 타입별 분기 (`chrome_ex/content_script.js`)**
    - [x] `processAutoFillByName` 함수에 `type` 매개변수 추가
    - [x] `activateTextareaInRow` 함수에 `type` 매개변수 추가
    - [x] Strategy 4 키워드 분기:
        - 과세특: '세부능력', '특기사항'
        - 행발: '행동특성', '종합의견', '행동', '특성'
    - [x] `startAutoFill`에서 `type` 매개변수 전달

## Phase 15: AI 텍스트 생성 후처리 로직 전면 개편 (완료)
- [x] **공통 유틸리티 파일 생성 (`utils/textProcessor.js`)**
    - [x] 중복 코드 제거: 4개 페이지에서 사용하던 `cleanMetaInfo`, `truncateToCharLimit` 통합
    - [x] 500자(1500 bytes) 절대 상한선 적용
- [x] **동적 버퍼 전략 (`getBufferRatio`, `getPromptCharLimit`)**
    - [x] 글자수 크기에 따른 동적 버퍼 비율 계산
        | 목표 글자수 | 버퍼 비율 | AI 요청 글자수 |
        |------------|----------|---------------|
        | ~100자 | 70% | 70자 요청 |
        | ~150자 | 75% | 112자 요청 |
        | ~200자 | 80% | 160자 요청 |
        | ~300자 | 85% | 255자 요청 |
        | 300자~ | 90% | 기본 90% |
- [x] **동적 프롬프트 지침 (`getCharacterGuideline`)**
    - [x] 100자 이하: 2-3개 짧은 문장, 각 15자 이내, `~함.`, `~음.`, `~임.` 종결 권장
    - [x] 200자 이하: 4-5개 문장, 각 20자 이내 권장
    - [x] 200자 초과: 기존 글자수 제한 지침 적용
- [x] **완전한 문장 트리밍 (`truncateToCompleteSentence`)**
    - [x] 문장 단위 분리 후 글자수 내에서 최대한 완전한 문장 유지
    - [x] 한국어 종결어미 패턴 인식: `함`, `음`, `임`, `됨`, `봄`, `다`, `요` 등
    - [x] 최소 50% 이상 내용 확보 보장 (첫 문장 fallback)
    - [x] 최후 수단 처리: 종결어미 패턴 검색 후 마침표 자동 추가

### 적용 페이지
- 과세특 (`/gwasetuk`) ✅
- 동아리 세특 (`/club`) ✅
- 행발 작성 (`/behavior`) ✅
- 가정통신문 (`/letter`) ✅

### 문제 해결
**기존 문제**: 100자 같은 극소 글자수 제한 시 문장이 중간에 잘림
```
예시: "...문제 해결을 위해 신중하게 접근하며." (불완전)
예시: "...팀을 이끄는 모습이." (불완전)
```

**개선 후**: 완전한 문장으로 마무리
```
예시: "친구와 협력하여 문제를 해결함." (완전)
예시: "리더십을 발휘하여 팀을 이끎." (완전)
```

## Phase 16: 크롬 확장 프로그램 행발 자동 입력 버그 수정 (완료)
> ⚠️ **과세특은 정상 작동** - 이 수정은 행발 페이지에서만 발생한 문제 해결

- [x] **문제 분석 (`chrome_ex/content_script.js`)**
    - [x] 문제: 행발 입력 시 1번 학생 칸만 입력되고 나머지는 "입력 완료"로 표시되지만 실제 입력 안 됨
    - [x] 원인: 행발 페이지에서 이전 학생의 textarea가 닫히지 않아 새 행 클릭 시 같은 textarea 재사용
    - [x] 로그에서 `aria-label row=N, expected=N+1` 불일치 확인
- [x] **Textarea 행 검증 로직 추가**
    - [x] 셀 안에서 찾은 textarea의 aria-label 행 번호 검증
    - [x] `isTextareaForRow()` 함수로 현재 행과 일치 여부 확인
    - [x] 불일치 시 "⚠ Found textarea in cell but wrong row" 경고 후 다른 방법 시도
- [x] **이전 Textarea 닫기 로직 강화 (3단계)**
    - [x] Method 1: Tab 키 전송 (데이터 저장 및 이동)
    - [x] Method 2: 그리드 바디 외부 클릭 (좌표 기반 MouseEvent)
    - [x] Method 3: ESC 키 전송 (강제 닫기)
    - [x] 각 단계 후 textarea 닫힘 여부 검증
    - [x] 최종 검증 로그: "✓ Previous textarea successfully closed" / "⚠ Warning: still exists"

## Phase 17: 크롬 확장 프로그램 행발 자동 입력 최종 안정화 (완료)
> ✅ **과세특 & 행발 모두 정상 작동**

- [x] **Tab 네비게이션 전략 적용**
    - [x] 이전 textarea에서 Tab 키로 다음 셀로 이동
    - [x] NEIS가 자동으로 새 textarea 생성하도록 활용
    - [x] Force-close 로직 대폭 간소화 (ESC/blur 제거)
- [x] **데이터 입력 방식 단순화**
    - [x] 기존 11가지 방법 → 과세특과 동일한 3줄 방식으로 통일
    - [x] `textarea.value = dataToFill`
    - [x] `input` 이벤트 + `change` 이벤트
- [x] **비활성 셀 건너뛰기 로직 검증**
    - [x] `textarea.readOnly` 체크
    - [x] `isCellReadonly()` 함수로 회색 처리된 셀 검증
    - [x] 건너뛴 학생 수 카운트 및 표시

### 최종 테스트 결과
- **과세특**: 27/27명 (100%) ✅
- **행발**: 23/23명 (100%) ✅

## Phase 18: 동아리 세특 페이지 학생별 개별 활동 기능 추가 (완료)
- [x] **Student 상태 구조 확장 (`app/club/page.js`)**
    - [x] `individualActivity` 필드 추가
    - [x] 모든 학생 생성/업데이트 로직에 적용
- [x] **엑셀 업로드 기능 개선**
    - [x] '활동 내용' 열 자동 인식 기능 추가
    - [x] 인식 키워드: 활동, 내용, 관찰내용, 관찰기록, 세부능력, 특기사항, 세특, 개별활동
    - [x] 디버깅 로그 추가 (헤더 파싱, 학생별 활동 매핑)
- [x] **학생 카드 UI 수정**
    - [x] 이름 입력 아래에 활동 내용 textarea 추가
    - [x] 플레이스홀더: "학생별 개별적으로 활동한 내용을 입력해주세요."
- [x] **생성 로직 개선**
    - [x] `calculateRelevanceScore` 함수로 키워드 기반 관련성 점수 계산
    - [x] 공통 활동과 학생별 활동 조합하여 프롬프트 생성
    - [x] 글자수 제한 시 학생별 활동과 관련성 높은 공통 활동 우선 선택

## Phase 19: 과세특 추가 지침 사항 기능 추가 (완료)
- [x] **State 추가 (`app/gwasetuk/page.js`)**
    - [x] `additionalInstructions` 상태 변수 추가
- [x] **프롬프트 연동**
    - [x] AI 프롬프트에 "⚠️ 반드시 지켜야 할 추가 지침 (최우선 적용)" 섹션 추가
    - [x] 다른 모든 규칙보다 우선하여 엄격히 준수하도록 강조
- [x] **UI 구현**
    - [x] 활동 내용 입력 섹션에 추가 지침 사항 textarea 추가
    - [x] 빨간색 테마로 중요도 시각적 강조
    - [x] 플레이스홀더: "예: 축구는 단체 경기가 아닌 개인별 수행 내용을 기준으로 작성해 주세요."
    - [x] 안내 문구: "위 지침은 AI가 최우선으로 엄격히 준수합니다."

## Phase 20: 랜딩 페이지 사용 안내 박스 추가 (완료)
- [x] **사용 안내 박스 UI 구현 (`app/page.js`)**
    - [x] 개인정보처리방침 안내 아래에 사용 안내 박스 추가
    - [x] 그라데이션 배경 (파란색 → 보라색)
    - [x] 상단 그라데이션 테두리 (파란색 → 보라색)
    - [x] 정보 아이콘 및 그라데이션 제목 텍스트
    - [x] 번호 목록 (원형 그라데이션 배지) - 3개 메인 항목
    - [x] 하위 목록 (보라색 점 불릿) - 2번 항목에 4개 하위 항목
- [x] **사용 안내 내용 구조**
    | 번호 | 내용 |
    |------|------|
    | 1 | 처음 사용하신다면 하단의 **사용 방법 영상** 시청을 추천 |
    | 2 | 영상 내용 외의 추가된 내용 (하위 4개) |
    | 2-① | 각 페이지의 **엑셀파일**은 **NEIS 세특의 엑셀 내려 받기** 후 업로드 시 자동 학생 추가 |
    | 2-② | **세특**과 **동아리활동**에서 '**학생별 개별 활동**' 입력 가능 |
    | 2-③ | **학생별 개별 활동 내용**과 **공통 활동 내용** 조합 생성 |
    | 2-④ | 세특 '**활동 내용 입력**' 칸에 '**추가 지침 사항**' 최우선 적용 |
    | 3 | **나이스 자동입력 확장프로그램** 사용 시 **같은 브라우저** 내에서 사용 |
- [x] **강조 스타일 적용**
    - [x] `.emphasis`: 파란색 계열 (사용 방법 영상, 학생별 개별 활동, NEIS 세특의 엑셀 내려 받기 등)
    - [x] `.emphasis-purple`: 보라색 계열 (세특, 동아리활동, 나이스 자동입력, 엑셀파일 등)
    - [x] `.emphasis-orange`: 주황색 계열 (활동 내용 입력, 추가 지침 사항, 같은 브라우저, 자동으로 학생이 추가 등)
- [x] **문의 안내 추가**
    - [x] 제목 옆에 문의 이메일 안내 텍스트 추가
    - [x] 제목보다 작은 글씨 크기 (0.75rem)
    - [x] 회색 계열 색상으로 차별화
- [x] **반응형 CSS 지원 (`app/globals.css`)**
    - [x] 모바일에서 세로 배치 전환

## Phase 21: 동아리 세특 버그 수정 및 추가 지침 기능 추가 (완료)
- [x] **버그 수정 (`app/club/page.js`)**
    - [x] `generateForStudent` 함수에서 `shuffledActivities` → `selectedActivities` 변수명 오류 수정
    - [x] 정의되지 않은 변수 참조로 인한 생성 실패 문제 해결
- [x] **추가 지침 사항 기능 추가 (`app/club/page.js`)**
    - [x] `additionalInstructions` state 변수 추가
    - [x] `generatePrompt` 함수에 추가 지침 섹션 추가 (최우선 적용)
    - [x] UI에 추가 지침 입력 textarea 추가 (과세특과 동일한 스타일)
    - [x] 빨간색 테마로 중요도 시각적 강조
    - [x] 플레이스홀더: "예: 토론 활동은 주제와 본인의 입장을 중심으로 작성해 주세요."

### 확인된 기존 기능 (정상 작동)
- 활동 순서 랜덤 셔플: 개별 활동 없을 시 `sort(() => 0.5 - Math.random())` 적용
- 개별 활동 있을 시 관련성 점수 기반 정렬 + 동점 시 랜덤

## Phase 22: 프롬프트 최적화 및 추가 지침 강화 (완료)
- [x] **추가 지침 우선순위 강화 (`app/gwasetuk/page.js`, `app/club/page.js`)**
    - [x] 추가 지침 위치를 프롬프트 **가장 마지막**으로 이동 (AI가 최우선 적용하도록)
    - [x] 강조 형태 개선: `【🚨 특별 지시 - 반드시 적용 🚨】`
    - [x] 사용자 지침을 인용문 형태로 명시: `→ "사용자 입력 지침"`
- [x] **마무리 요약 문장 금지 강화**
    - [x] 핵심 원칙 추가: "오직 활동 내용만 서술하고, 마무리/요약/정리 문장은 절대 작성하지 않음"
    - [x] 금지 표현 목록 확장: '이러한', '이를 통해', '이와 같이', '이런', '앞으로', '향후', '결과적으로', '종합적으로'
    - [x] 별도 섹션으로 분리: `## ⛔ 절대 금지 (마무리 문장)`
    - [x] "마지막 문장도 반드시 구체적인 활동 내용이나 학습 과정에 대한 서술이어야 함" 지시 추가
- [x] **활동 순서 유지 기능 추가**
    - [x] 추가 지침에 '순서' 키워드 포함 시 랜덤 셔플 건너뛰기
    - [x] "활동 내용 입력 순서대로 생성" 같은 지침 적용 가능
    - [x] 콘솔 로그: `[활동 선택] 추가 지침에 '순서' 포함 - 입력 순서 유지`
- [x] **디버깅 로그 추가**
    - [x] 프롬프트 생성 시 추가 지침 포함 여부 콘솔 출력
    - [x] `[추가 지침] 입력값: "..."`, `[추가 지침] 포함 여부: 포함됨/없음`

## Phase 23: AI 모델 업그레이드 및 시스템 메시지 강화 (완료)
- [x] **AI 모델 변경 (`app/api/generate/route.js`)**
    - [x] GPT-4o-mini → GPT-4o로 업그레이드
    - [x] 복잡한 추가 지침을 더 정확하게 따르도록 개선
- [x] **시스템 메시지에 추가 지침 포함**
    - [x] 추가 지침을 user 메시지가 아닌 **system 메시지**로 전달
    - [x] AI가 시스템 메시지를 더 권위있게 따르는 특성 활용
    - [x] 형식: `【CRITICAL INSTRUCTION - MUST FOLLOW】` + 사용자 지침 인용
- [x] **프론트엔드 API 호출 수정 (`app/gwasetuk/page.js`, `app/club/page.js`)**
    - [x] `additionalInstructions`를 API body에 별도로 전달
    - [x] 시스템 메시지와 사용자 프롬프트 분리

### 기대 효과
- "활동 5개씩 골라서 풍부하게 작성" 같은 복잡한 지침도 정확히 따름
- 추가 지침에 대한 AI 준수율 향상

## Phase 24: 추가 지침 처리 로직 단순화 (완료)
- [x] **'순서' 키워드 감지 로직 제거 (`app/gwasetuk/page.js`, `app/club/page.js`)**
    - [x] 코드 레벨에서 '순서' 키워드 감지 → 셔플 건너뛰기 로직 삭제
    - [x] GPT-4o가 추가 지침을 직접 해석하고 처리하도록 변경
    - [x] 활동 목록은 항상 원래 순서대로 AI에게 전달
- [x] **디버깅 콘솔 로그 제거**
    - [x] `[활동 선택]` 로그 삭제
    - [x] `[프롬프트 생성]` 로그 삭제
    - [x] `[추가 지침]` 로그 삭제

### 변경된 동작
| 구분 | 기존 | 변경 후 |
|-----|------|--------|
| 순서 지침 | 코드에서 '순서' 감지 → 셔플 안 함 | AI가 직접 해석 |
| 랜덤 지침 | 코드에서 랜덤 셔플 | AI가 직접 랜덤 선택 |
| 활동 개수 | 코드 로직 없음 | AI가 지침에 따라 선택 |

### 장점
- 코드 복잡도 감소
- 추가 지침의 유연성 증가 (AI가 다양한 지시 해석 가능)
- GPT-4o의 지시 이해 능력 활용

## Phase 25: 랜덤 셔플, 복사 버튼, 동적 모델 선택 (완료)
- [x] **'랜덤' 키워드 감지 시 활동 셔플 (`app/gwasetuk/page.js`, `app/club/page.js`)**
    - [x] 추가 지침에 '랜덤' 또는 '무작위' 키워드 포함 시 활동 목록 셔플
    - [x] AI가 위에서부터 선택해도 결과적으로 랜덤 효과 발생
- [x] **복사 버튼 추가 (`app/gwasetuk/page.js`, `app/club/page.js`, `app/behavior/page.js`)**
    - [x] 생성된 결과 아래에 작은 "복사" 버튼 추가
    - [x] 클릭 시 클립보드에 복사 → "복사됨!" 피드백 (1.5초)
    - [x] Clipboard API fallback 구현 (HTTP 환경 대응)
- [x] **동적 모델 선택 (`app/api/generate/route.js`)**
    - [x] 추가 지침 있음 → GPT-4o (정확한 지시 이행)
    - [x] 추가 지침 없음 → GPT-4o-mini (16배 비용 절감)
    - [x] 콘솔 로그로 사용 모델 확인 가능

### 동적 모델 선택 로직
| 추가 지침 | 사용 모델 | 비용 |
|----------|----------|-----|
| 있음 | GPT-4o | 기본 |
| 없음 | GPT-4o-mini | 16배 저렴 |

